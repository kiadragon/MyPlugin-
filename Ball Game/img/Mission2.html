<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<style type="text/css">
	#drag {
		position: relative;
		left: 0px;
		top: 0px;
		cursor: crosshair;
	}
	</style>
</head>
<body>
	<div id="drag">
	我是移动盒子！。。@1@#%3*…8@#…%￥￥##
	</div>

	<script>
	(function() {
		var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame ||
                            		window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
		window.requestAnimationFrame = requestAnimationFrame;

		var cancelAnimationFrame = window.cancelAnimationFrame || window.mozCancelAnimationFrame ||
									window.webkitCancelAnimationFrame || window.msCancelAnimationFrame;
		window.cancelAnimationFrame = cancelAnimationFrame;
	})();

	var timestamp = 0.01;
	var x = document.getElementById('drag');

	var drag = function(item) {
			var distanceMouseItemX;
			var distanceMouseItemY;
			var dragAnimation;
			var flag = false;

			document.onmousemove = function() {
				event = event || window.event;
				beginDrag = function(event) { 
					return function(timestamp) {
						console.log(distanceMouseItemX, distanceMouseItemY, event.x, event.y);
						item.style.left = (event.x - distanceMouseItemX) + "px";
						item.style.top = (event.y - distanceMouseItemY) + "px";
						if (flag)
							requestAnimationFrame(beginDrag);
					}	
				}(event)

				item.onmousedown = function() {
					event = event || window.event;
					distanceMouseItemX = event.x - parseInt(item.style.left);
					distanceMouseItemY = event.y - parseInt(item.style.top);
					//console.log(distanceMouseItemX, distanceMouseItemY, event.x, event.y, item.style.left, item.style.top);
					flag = true;
					dragAnimation = requestAnimationFrame(beginDrag);
				}
				// maybe onclick
				item.onclick = function() {
					flag = false;
					cancelAnimationFrame(dragAnimation);
				}
			}
		}
	
	x.style.left = "0px";
	x.style.top = "0px";
	drag(x);
	</script>
</body>
</html>